<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="holimapper">
	
	
	<resultMap id="holiResultMap" type="WorkStatusDto"> 
	<result column="USER_NO" property="userNo"/>
	<result column="AR_DATE" property="arDate"/>
	<result column="WEEKEND_DATE" property="weekendDate"/>
	<result column="AR_TIME" property="arTime"/>
	<result column="AR_AV" property="arAv"/>
	<result column="WEEKEND_TIME" property="weekendTime"/>
	<result column="work_STATUS" property="workStatus"/>
	</resultMap>
	 <resultMap id="commuteResultMap" type="CommuteDto">
   <result column="user_NO" property="userNo"/>
   <result column="user_name" property="userName"/>
   <result column="WORK_IN" property="workIn"/>
   <result column="WORK_OUT" property="workOut"/>
   <result column="IN_STATUS" property="inStatus"/>
   <result column="OUT_STATUS" property="outStatus"/>
   <result column="HOLIDAY" property="holiday"/>
   </resultMap>
	<select id="selectworkStatus" resultMap="holiResultMap">
			select *
			from T_ATTENDANCE_RECORD
			where user_no = #{userNo}
	</select>
	  <insert id="insertCheckIn">
    INSERT INTO T_COMMUTE (USER_NO, USER_NAME, WORK_IN, IN_STATUS)
    VALUES (#{userNo}, #{userName}, CURRENT_TIME, '출근')
    ON DUPLICATE KEY UPDATE
        WORK_IN = CURRENT_TIME,
        IN_STATUS = '출근';
   </insert>
   <update id="updateCheckOut">
    UPDATE T_COMMUTE
    SET 
        WORK_OUT = CURRENT_TIME,
        OUT_STATUS = '퇴근',
        HOLIDAY = HOLIDAY + TIMESTAMPDIFF(MINUTE, WORK_IN, CURRENT_TIME),
        WORK_DAYS = WORK_DAYS + 1
    WHERE USER_NO = #{userNo};

    UPDATE T_ATTENDANCE_RECORD
    SET 
        AR_TIME = AR_TIME + TIMESTAMPDIFF(MINUTE, WORK_IN, CURRENT_TIME),
        AR_DATE = AR_DATE + 1,
        AR_AV = (AR_TIME + TIMESTAMPDIFF(MINUTE, WORK_IN, CURRENT_TIME)) / (AR_DATE + 1)
    WHERE USER_NO = #{userNo};
   </update>
   
</mapper>