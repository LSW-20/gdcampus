<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="chatMapper">


	<resultMap id="chatRoomResultMap" type="ChatRoomDto">
		<result column="ROOM_NO" property="roomNo"/>
		<result column="ROOM_NAME" property="roomName"/>
		<result column="ROOM_TYPE" property="roomType"/>
		<result column="CREATE_DATETIME" property="createDateTime"/>
		<result column="CREATE_USER" property="createUser"/>
		<result column="STATUS" property="status"/>				
	</resultMap>
	
	<resultMap id="userChatRoomResultMap" type="UserChatRoomDto">
		<result column="USER_NO" property="userNo"/>
		<result column="ROOM_NO" property="roomNo"/>
		<result column="JOIN_TIME" property="joinTime"/>
		<result column="JOIN_YN" property="joinYN"/>	
	</resultMap>
	



	<!-- (상우) 채팅방 전체 리스트 조회 -->
	<select id="selectChatRoomList" resultMap="chatRoomResultMap">
		select 
					 ROOM_NO
		     , ROOM_NAME
		     , ROOM_TYPE
				 , CREATE_DATETIME
				 , CREATE_USER
			   , STATUS
			from T_CHAT_ROOM    
	</select>


	<!-- (상우) 채팅방 번호로 채팅방 인원수 조회 -->
	<select id="selectChatRoomPeopleCount" resultType="_int">
		select 
					 COUNT(*)
		  from T_USER_CHAT_ROOM
		 where ROOM_NO = ${chatRoomNo} 
		   and JOIN_YN = 'Y'
	</select>
	
	
	<!-- (상우) 채팅방 번호로 유저-채팅방 매핑 테이블에서 user_no, join_time, join_yn 조회 -->
	<select id="selectUserChatRoomList" resultMap="userChatRoomResultMap">
		select 
					 USER_NO
				 , ROOM_NO
				 , JOIN_TIME
				 , JOIN_YN
		  from T_USER_CHAT_ROOM
		 where ROOM_NO = ${chatRoomNo} 	 
		   and JOIN_YN = 'Y'
	</select>
	
	
	<!-- (상우) 채팅방 생성 -->
	<insert id="makeChatRoom">
		insert
		  into T_CHAT_ROOM
		  (
			  ROOM_NO
			,	ROOM_NAME
			, ROOM_TYPE
			,	CREATE_DATETIME
			,	CREATE_USER
			,	STATUS
		  )
		 values 
		 (
		 	 SEQ_CHNO.NEXTVAL
		 , #{title}
		 , #{type}
		 , SYSDATE
		 , #{createUser}
		 , 'Y' 
		 ) 
	</insert>
	
	<!-- (상우) 채팅방 생성 후 초대인원들 매핑테이블에 담기 -->
	<insert id="insertChatMapping">
		insert
		  into T_USER_CHAT_ROOM
		  (
			  USER_NO
      , ROOM_NO
      , JOIN_TIME
      , JOIN_YN
		  )
		 values 
		 (
		 	 #{userNo}
		 , SEQ_CHNO.CURRVAL
		 , SYSDATE
		 , 'Y' 
		 ) 
	</insert>
	


	
</mapper>